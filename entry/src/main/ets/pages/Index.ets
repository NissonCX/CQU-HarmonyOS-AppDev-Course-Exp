import router from '@ohos.router';
import { ThemeManager } from '../model/ThemeManager';
import { ThemeType, ThemeColors } from '../model/Theme';

@Entry
@Component
struct Index {
  @State message: string = 'Hello World';
  @State currentTheme: ThemeType = ThemeManager.getInstance().getCurrentTheme();
  @State themeColors: ThemeColors = ThemeManager.getInstance().getCurrentColors();
  
  // ç»„ä»¶åŠ è½½æ—¶æ·»åŠ ä¸»é¢˜ç›‘å¬å™¨
  aboutToAppear(): void {
    ThemeManager.getInstance().addThemeChangeListener((theme: ThemeType, colors: ThemeColors) => {
      this.currentTheme = theme;
      this.themeColors = colors;
    });
  }
  
  // ç»„ä»¶é”€æ¯æ—¶ç§»é™¤ä¸»é¢˜ç›‘å¬å™¨
  aboutToDisappear(): void {
    // æ³¨æ„ï¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼Œåº”è¯¥ä¿å­˜ç›‘å¬å™¨çš„å¼•ç”¨ä»¥ä¾¿ç§»é™¤
    // è¿™é‡Œä¸ºäº†ç®€åŒ–ï¼Œæš‚æ—¶ä¸å®ç°ç§»é™¤é€»è¾‘
  }
  
  // åˆ‡æ¢ä¸»é¢˜
  private toggleTheme(): void {
    ThemeManager.getInstance().toggleTheme();
  }

  build() {
    Column() {
      // é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ - å±…ä¸­å¯¹ç§°å¸ƒå±€
      Column() {
        Text('ğŸ•¹ï¸ ç»å…¸å°æ¸¸æˆåˆé›† ğŸ®')
          .fontSize(36)
          .fontWeight(FontWeight.Bold)
          .textAlign(TextAlign.Center)
          .fontColor(this.themeColors.primaryText)

        Text('äº«å—ç»å…¸ï¼ŒæŒ‘æˆ˜æ™ºæ…§')
          .fontSize(16)
          .fontColor(this.themeColors.secondaryText)
          .margin({ top: 8 })
      }
      .width('100%')
      .alignItems(HorizontalAlign.Center)
      .margin({ top: 60, bottom: 40 })
      
      // ä¸»é¢˜åˆ‡æ¢æŒ‰é’® - å±…ä¸­ä½ç½®
      Row() {
        Text('ğŸ¨ ä¸»é¢˜')
          .fontSize(14)
          .fontColor(this.themeColors.secondaryText)
          .margin({ right: 10 })
        
        Button(ThemeManager.getInstance().getCurrentTheme() === ThemeType.LIGHT ? 'â˜€ï¸ ' : 'ğŸŒ™ ')
          .width(80)
          .height(36)
          .backgroundColor(this.themeColors.buttonBackground)
          .fontColor(this.themeColors.buttonText)
          .borderRadius(18)
          .border({ width: 1, color: this.themeColors.buttonBorder })
          .shadow({
            radius: 4,
            color: this.themeColors.cardShadow,
            offsetX: 1,
            offsetY: 1
          })
          .onClick(() => this.toggleTheme())
      }
      .width('100%')
      .justifyContent(FlexAlign.Center)
      .margin({ bottom: 30 })

      // æ¸¸æˆæŒ‰é’®åŒºåŸŸ - å±…ä¸­å¯¹ç§°å¸ƒå±€
      Column({ space: 16 }) {
        // æ‰«é›·æ¸¸æˆæŒ‰é’®
        Button() {
          Column() {
            Text('ğŸš© æ‰«é›·æ¸¸æˆ ğŸ’£')
              .fontSize(22)
              .fontWeight(FontWeight.Bold)
              .fontColor(this.themeColors.buttonText)
              .margin({ bottom: 8 })
            
            Text('é€»è¾‘æ¨ç†ï¼ŒæŒ‘æˆ˜é€Ÿåº¦')
              .fontSize(14)
              .fontColor(this.themeColors.secondaryText)
          }
          .width('100%')
          .height('100%')
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)
        }
        .width(280)
        .height(70)
        .backgroundColor(this.themeColors.cardBackground)
        .borderRadius(16)
        .border({ width: 1, color: this.themeColors.cardBorder })
        .shadow({
          radius: 8,
          color: this.themeColors.cardShadow,
          offsetX: 2,
          offsetY: 2
        })
        .onClick(() => {
          router.pushUrl({
            url: 'pages/Minesweeper'
          });
        })

        // 24ç‚¹æ¸¸æˆæŒ‰é’®
        Button() {
          Column() {
            Text('ğŸƒ 24ç‚¹æ¸¸æˆ ğŸ§®')
              .fontSize(22)
              .fontWeight(FontWeight.Bold)
              .fontColor(this.themeColors.buttonText)
              .margin({ bottom: 8 })
            
            Text('æ•°å­¦è¿ç®—ï¼Œé€»è¾‘æŒ‘æˆ˜')
              .fontSize(14)
              .fontColor(this.themeColors.secondaryText)
          }
          .width('100%')
          .height('100%')
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)
        }
        .width(280)
        .height(70)
        .backgroundColor(this.themeColors.cardBackground)
        .borderRadius(16)
        .border({ width: 1, color: this.themeColors.cardBorder })
        .shadow({
          radius: 8,
          color: this.themeColors.cardShadow,
          offsetX: 2,
          offsetY: 2
        })
        .onClick(() => {
          router.pushUrl({
            url: 'pages/24Points'
          });
        })

        // æ‹¼å›¾åå®¹é“æŒ‰é’®
        Button() {
          Column() {
            Text('ğŸ§© æ‹¼å›¾åå®¹é“ ğŸ§ ')
              .fontSize(22)
              .fontWeight(FontWeight.Bold)
              .fontColor(this.themeColors.buttonText)
              .margin({ bottom: 8 })
            
            Text('é€»è¾‘æ¨ç†ï¼Œç©ºé—´æƒ³è±¡')
              .fontSize(14)
              .fontColor(this.themeColors.secondaryText)
          }
          .width('100%')
          .height('100%')
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)
        }
        .width(280)
        .height(70)
        .backgroundColor(this.themeColors.cardBackground)
        .borderRadius(16)
        .border({ width: 1, color: this.themeColors.cardBorder })
        .shadow({
          radius: 8,
          color: this.themeColors.cardShadow,
          offsetX: 2,
          offsetY: 2
        })
        .onClick(() => {
          router.pushUrl({
            url: 'pages/SlidingPuzzle'
          });
        })
      }
      .width('100%')
      .alignItems(HorizontalAlign.Center)
      .justifyContent(FlexAlign.Center)
      .layoutWeight(1)

      // åº•éƒ¨ä¿¡æ¯åŒºåŸŸ - å±…ä¸­å¸ƒå±€
      Column() {
        Text('ğŸ¯ é€‰æ‹©ä¸€ä¸ªæ¸¸æˆå¼€å§‹æŒ‘æˆ˜å§ï¼ ğŸ¯')
          .fontSize(14)
          .fontColor(this.themeColors.tertiaryText)
          .margin({ bottom: 8 })

        Text('ğŸ§  æ™ºåŠ›æŒ‘æˆ˜ Â· â±ï¸ ä¼‘é—²å¨±ä¹')
          .fontSize(12)
          .fontColor(this.themeColors.tertiaryText)
          .margin({ bottom: 8 })

        Text('ğŸ‘¨â€ğŸ’» åˆ¶ä½œäººï¼šNisson_CX')
          .fontSize(12)
          .fontColor(this.themeColors.tertiaryText)
          .margin({ bottom: 30 })
      }
      .width('100%')
      .alignItems(HorizontalAlign.Center)
    }
    .width('100%')
    .height('100%')
    .backgroundColor(this.themeColors.background)
    .expandSafeArea([SafeAreaType.SYSTEM], [SafeAreaEdge.TOP, SafeAreaEdge.BOTTOM])
  }
}